version: 2

models:
  - name: dim_customer_churn_features
    description: "{{ doc('dim_customer_churn_features') }}"
    config:
      tags:
        - daily
        - mart
        - features
    columns:
      - name: customer_id
        description: Unique identifier for each customer.
        tests:
          - unique
          - not_null

      - name: anonymized_demographics
        description: Anonymized demographic information about the customer.

      - name: anonymized_location
        description: Anonymized location information for the customer.

      - name: join_date
        description: The date the customer first joined.
        tests:
          - not_null

      - name: account_type
        description: Type of account held by the customer (e.g., Personal, Business).

      - name: contract_term
        description: The duration of the customer's contract (e.g., Month-to-Month, 1 Year, 2 Year).

      - name: primary_service_type
        description: The type of the primary service used by the customer (Placeholder - requires business logic definition).

      - name: preferred_payment_method
        description: The customer's preferred method for payments.

      - name: tenure_days
        description: Number of days the customer has been active.
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"

      - name: active_services_count
        description: Count of currently active services for the customer.
        tests:
          - not_null

      - name: total_monthly_charge
        description: Total monthly charge for all active services.
        tests:
          - not_null

      - name: avg_monthly_charge_active
        description: Average monthly charge across active services.

      - name: avg_billing_amount_last_6m
        description: Average billing amount over the last 6 months.

      - name: total_billed_amount_last_12m
        description: Total amount billed to the customer in the last 12 months.
        tests:
          - not_null

      - name: late_payment_count_last_12m
        description: Number of late payments in the last 12 months.
        tests:
          - not_null

      - name: avg_days_to_pay_last_6m
        description: Average number of days taken to pay bills over the last 6 months.

      - name: total_support_tickets
        description: Total number of support tickets raised by the customer.
        tests:
          - not_null

      - name: open_support_tickets_count
        description: Number of currently open support tickets.
        tests:
          - not_null

      - name: support_tickets_last_3m
        description: Number of support tickets raised in the last 3 months.
        tests:
          - not_null

      - name: avg_ticket_resolution_time_days
        description: Average time taken to resolve support tickets in days.

      - name: avg_monthly_data_usage_last_6m
        description: Average monthly data usage (GB) over the last 6 months.

      - name: avg_monthly_call_minutes_last_6m
        description: Average monthly call minutes over the last 6 months.

      - name: avg_monthly_sms_count_last_6m
        description: Average monthly SMS count over the last 6 months.

      - name: total_marketing_interactions_last_12m
        description: Total number of marketing interactions in the last 12 months.
        tests:
          - not_null

      - name: marketing_response_rate_last_12m
        description: Response rate to marketing interactions in the last 12 months.

      - name: days_since_last_interaction
        description: Number of days since the last marketing interaction.

      - name: days_since_last_support_ticket
        description: Number of days since the last support ticket was created.

      - name: Label
        description: Churn label (1 if churned, 0 otherwise). Target variable for prediction models.
        tests:
          - not_null
          - accepted_values:
              values: [0, 1]

      - name: dbt_updated_at
        description: Timestamp indicating when the record was last updated by dbt.
        tests:
          - not_null
