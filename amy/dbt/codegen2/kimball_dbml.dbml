//// ----------------------------------------------------
//// Novacom Project A - SILVER Schema
//// Platform: Snowflake
//// Generated by: Expert Data Engineer AI
//// ----------------------------------------------------

Project "Novacom Project A" {
  database_type: 'Snowflake'
  Note: 'Kimball model for customer churn analysis in the SILVER schema.'
}

//// ---------------- Dimensions ---------------------

Table SILVER.DimCustomer {
  CustomerSK int [pk, not null, note: 'Surrogate key for the Customer dimension']
  CustomerID int [not null, note: 'Natural key from crm_customers']
  AccountID int [not null, note: 'Natural key from crm_accounts']
  City varchar(100) [not null]
  State varchar(50) [not null, note: 'Standardized state code (e.g., ISO 3166-2:US)']
  ZipCode varchar(20) [note: 'Standardized postal code']
  Country varchar(50) [not null, note: 'Standardized country code (e.g., ISO 3166-1 alpha-2/3)']
  CustomerSegment varchar(50) [not null]
  CustomerTier varchar(50) [not null]
  StartDate date [not null, note: 'Customer start date']
  Status varchar(50) [not null, note: 'Customer status (e.g., Active, Inactive, Churned)']
  AccountType varchar(50) [not null]
  AccountCreationDate date [not null]
  AccountStatus varchar(50) [not null, note: 'Account status']
  AccountCurrencyCode varchar(3) [not null, note: 'ISO 4217 currency code']
  AccountBalance decimal(18, 2)
  SCDStartDate timestamp [not null, note: 'Start date for the dimension record version']
  SCDEndDate timestamp [not null, note: 'End date for the dimension record version']
  SCDIsCurrent boolean [not null, note: 'Flag indicating if this is the current version of the record']

  Note: 'Type 2 Slowly Changing Dimension for Customers. Sources: crm_customers, crm_accounts. PII attributes excluded.'
}

Table SILVER.DimService {
  ServiceSK int [pk, not null, note: 'Surrogate key for the Service dimension']
  ServiceID int [not null, note: 'Natural key from prv_services']
  ServiceName varchar(255) [not null]
  ServiceType varchar(50) [not null]
  Description varchar(1000)
  MonthlyCost decimal(18, 2) [not null]
  ActiveFlag boolean [not null]
  ProvisioningTeam varchar(100)
  CreatedDate date
  SCDStartDate timestamp [not null, note: 'Start date for the dimension record version']
  SCDEndDate timestamp [not null, note: 'End date for the dimension record version']
  SCDIsCurrent boolean [not null, note: 'Flag indicating if this is the current version of the record']

  Note: 'Type 2 Slowly Changing Dimension for Services. Source: prv_services.'
}

Table SILVER.DimCampaign {
  CampaignSK int [pk, not null, note: 'Surrogate key for the Campaign dimension']
  CampaignID int [not null, note: 'Natural key from mkt_campaigns']
  Name varchar(255) [not null]
  CampaignType varchar(50) [not null]
  Objective varchar(1000)
  TargetAudience varchar(100)
  ConversionGoal varchar(255)
  StartDate date [not null]
  EndDate date [not null]
  Budget decimal(18, 2) [not null]
  SCDStartDate timestamp [not null, note: 'Start date for the dimension record version']
  SCDEndDate timestamp [not null, note: 'End date for the dimension record version']
  SCDIsCurrent boolean [not null, note: 'Flag indicating if this is the current version of the record']

  Note: 'Type 2 Slowly Changing Dimension for Marketing Campaigns. Source: mkt_campaigns.'
}

Table SILVER.DimEquipment {
  EquipmentSK int [pk, not null, note: 'Surrogate key for the Equipment dimension']
  EquipmentID int [not null, note: 'Natural key from nwk_equipment']
  EquipmentType varchar(50) [not null]
  Model varchar(100) [not null]
  SerialNumber varchar(100) [not null, note: 'Potential natural key']
  FirmwareVersion varchar(50)
  Location varchar(255)
  Status varchar(50) [not null, note: 'Equipment status (e.g., Active, Inactive, Maintenance)']
  LastMaintenanceDate date
  SCDStartDate timestamp [not null, note: 'Start date for the dimension record version']
  SCDEndDate timestamp [not null, note: 'End date for the dimension record version']
  SCDIsCurrent boolean [not null, note: 'Flag indicating if this is the current version of the record']

  Note: 'Type 2 Slowly Changing Dimension for Network Equipment. Source: nwk_equipment.'
}

Table SILVER.DimDate {
  DateSK int [pk, not null, note: 'Surrogate key for the Date dimension (e.g., YYYYMMDD)']
  Date date [not null, unique]
  DayOfWeek varchar(10) [not null]
  DayOfMonth int [not null]
  DayOfYear int [not null]
  WeekOfYear int [not null]
  Month int [not null]
  MonthName varchar(10) [not null]
  Quarter int [not null]
  Year int [not null]
  IsWeekend boolean [not null]
  IsMonthEnd boolean [not null]
  IsQuarterEnd boolean [not null]
  IsYearEnd boolean [not null]

  Note: 'Type 1 Dimension for Calendar Dates. Source: Generated.'
}

Table SILVER.DimTicketStatus {
  TicketStatusSK int [pk, not null, note: 'Surrogate key for Ticket Status']
  TicketStatusName varchar(50) [unique, not null]

  Note: 'Type 1 Reference Dimension for Ticket Status. Source: sup_tickets (distinct status).'
}

Table SILVER.DimTicketPriority {
  TicketPrioritySK int [pk, not null, note: 'Surrogate key for Ticket Priority']
  TicketPriorityName varchar(50) [unique, not null]

  Note: 'Type 1 Reference Dimension for Ticket Priority. Source: sup_tickets (distinct priority).'
}

Table SILVER.DimInvoiceStatus {
  InvoiceStatusSK int [pk, not null, note: 'Surrogate key for Invoice Status']
  InvoiceStatusName varchar(50) [unique, not null]

  Note: 'Type 1 Reference Dimension for Invoice Status. Source: bil_invoices (distinct status).'
}

//// ---------------- Facts -------------------------

Table SILVER.FactCustomerSnapshot {
  CustomerSK int [not null, note: 'Foreign key to DimCustomer']
  SnapshotDateSK int [not null, note: 'Foreign key to DimDate, representing the snapshot period end date']
  ChurnLabel int [not null, note: 'Churn indicator (0=No, 1=Yes) for the period']
  TotalBilledAmountPeriod decimal(18, 2) [note: 'Total amount billed to the customer during the snapshot period']
  TotalPaidAmountPeriod decimal(18, 2) [note: 'Total amount paid by the customer during the snapshot period']
  OutstandingBalanceEndPeriod decimal(18, 2) [note: 'Outstanding balance at the end of the snapshot period']
  DaysSinceLastPayment int [note: 'Days since the last payment was received as of the snapshot date']
  ActiveServicesCount int [note: 'Number of active services at the end of the snapshot period']
  TotalDataConsumedGBPeriod decimal(18, 4) [note: 'Total data consumed (in GB) during the snapshot period']
  SupportTicketsOpenedPeriod int [note: 'Number of support tickets opened during the snapshot period']
  SupportTicketsResolvedPeriod int [note: 'Number of support tickets resolved during the snapshot period']
  AvgTicketResolutionTimePeriod decimal(10, 2) [note: 'Average time (e.g., hours) to resolve tickets during the period']
  MarketingCampaignsTargetedPeriod int [note: 'Number of distinct marketing campaigns the customer was targeted by']
  MarketingResponsesPeriod int [note: 'Number of responses to marketing campaigns during the period']
  NetworkOutagesCountPeriod int [note: 'Number of network outages affecting the customer during the period']
  CurrentAccountBalance decimal(18, 2) [note: 'Account balance snapshot at the end of the period']

  Indexes {
    (CustomerSK, SnapshotDateSK) [pk] // Composite Primary Key
  }

  Note: 'Periodic snapshot fact table capturing customer metrics monthly. Grain: One row per customer per snapshot period. Source: StgCustomerMonthlyActivity.'
}

//// ---------------- Relationships ------------------

Ref: SILVER.FactCustomerSnapshot.CustomerSK > SILVER.DimCustomer.CustomerSK // Many-to-one
Ref: SILVER.FactCustomerSnapshot.SnapshotDateSK > SILVER.DimDate.DateSK // Many-to-one

// Note: Relationships to other dimensions (Service, Campaign, Equipment, TicketStatus, TicketPriority, InvoiceStatus) 
// are typically handled through bridge tables or directly in other fact tables (e.g., FactServiceUsage, FactTicketActivity) 
// depending on the specific analysis requirements. They are not directly linked to this snapshot fact based on the provided context.
