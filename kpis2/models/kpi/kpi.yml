version: 2

models:
  - name: arpu
    description: Average Revenue Per User
    tests:
      - dbt_utils.expression_is_true:
          expression: "total_revenue >= 0"
      - dbt_utils.expression_is_true:
          expression: "total_customers >= 0"
      - dbt_utils.expression_is_true:
          expression: "arpu >= 0"
    columns:
      - name: total_revenue
        description: Total revenue for the period
        tests:
          - not_null
          - positive_values
      - name: total_customers
        description: Total number of customers
        tests:
          - not_null
          - positive_values
      - name: arpu
        description: Average Revenue Per User
        tests:
          - not_null
          - positive_values
      - name: period_start
        description: Start date of the period
        tests:
          - not_null
      - name: period_end
        description: End date of the period
        tests:
          - not_null
      - name: calculated_at
        description: Timestamp when the KPI was calculated
        tests:
          - not_null

  - name: customer_acquisition_cost
    description: Cost to acquire a new customer
    tests:
      - dbt_utils.expression_is_true:
          expression: "total_acquisition_cost >= 0"
      - dbt_utils.expression_is_true:
          expression: "new_customers >= 0"
    columns:
      - name: total_acquisition_cost
        description: Total cost of acquisition activities
        tests:
          - not_null
          - positive_values
      - name: new_customers
        description: Number of new customers acquired
        tests:
          - not_null
          - positive_values
      - name: cac
        description: Customer Acquisition Cost
        tests:
          - positive_values
      - name: period_start
        description: Start date of the period
        tests:
          - not_null
      - name: period_end
        description: End date of the period
        tests:
          - not_null

  - name: customer_lifetime_value
    description: Predicted revenue from a customer over their lifetime
    columns:
      - name: customer_id
        description: Customer identifier
        tests:
          - not_null
          - unique
      - name: lifetime_value
        description: Predicted lifetime value
        tests:
          - not_null
          - positive_values
      - name: total_revenue
        description: Total revenue to date
        tests:
          - not_null
          - positive_values
      - name: customer_age_months
        description: Customer tenure in months
        tests:
          - not_null
          - positive_values

  - name: customer_retention_rate
    description: Rate at which customers are retained over a period
    columns:
      - name: period_start
        description: Start date of the period
        tests:
          - not_null
      - name: period_end
        description: End date of the period
        tests:
          - not_null
      - name: customers_start
        description: Number of customers at start of period
        tests:
          - not_null
          - positive_values
      - name: customers_end
        description: Number of customers at end of period
        tests:
          - not_null
          - positive_values
      - name: customers_retained
        description: Number of customers retained from start to end
        tests:
          - not_null
          - positive_values
      - name: retention_rate
        description: Retention rate (0-1)
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: "retention_rate >= 0 AND retention_rate <= 1"

  - name: service_adoption_rate
    description: Rate at which customers adopt specific services
    columns:
      - name: service_id
        description: Service identifier
        tests:
          - not_null
      - name: service_name
        description: Name of the service
        tests:
          - not_null
      - name: total_customers
        description: Total number of customers
        tests:
          - not_null
          - positive_values
      - name: customers_using_service
        description: Number of customers using the service
        tests:
          - not_null
          - positive_values
      - name: adoption_rate
        description: Adoption rate (0-1)
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: "adoption_rate >= 0 AND adoption_rate <= 1"
