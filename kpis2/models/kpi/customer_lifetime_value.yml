version: 2

models:
  - name: customer_lifetime_value
    description: |
      The Customer Lifetime Value (CLV) KPI calculates the average revenue generated by a customer throughout their entire relationship with the company.
      
      Formula: CLV = SUM(bil_invoices.total_amount) / COUNT(DISTINCT crm_customers.customer_id)
    columns:
      - name: customer_id
        description: "Unique identifier for the customer"
        tests:
          - not_null
          - unique
      - name: lifetime_value
        description: |
          The calculated Customer Lifetime Value. This metric represents the average revenue per customer over the duration of their relationship.
        tests:
          - not_null
          - positive_values
      - name: total_revenue
        description: "Total revenue generated by the customer to date"
        tests:
          - not_null
      - name: customer_age_months
        description: "Number of months the customer has been active"
        tests:
          - not_null
    meta:
      kpi: true
      kpi_details:
        name: "Customer Lifetime Value (CLV)"
        definition: "Average revenue generated by a customer throughout their entire relationship with the company."
        formula: "SUM(bil_invoices.total_amount) / COUNT(DISTINCT crm_customers.customer_id)"
